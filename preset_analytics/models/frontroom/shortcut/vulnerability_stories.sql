{{ config(
    materialized='view',
) }}

SELECT
  *,
  (SELECT COUNT(1) FROM UNNEST(label_name_array) AS label_name WHERE label_name = 'Critical Vulnerability') > 0 AS is_critical_vulnerability,
  (SELECT COUNT(1) FROM UNNEST(label_name_array) AS label_name WHERE label_name = 'High Vulnerability') > 0 AS is_high_vulnerability,
  (SELECT COUNT(1) FROM UNNEST(label_name_array) AS label_name WHERE label_name = 'Moderate Vulnerability') > 0 AS is_moderate_vulnerability,
  (SELECT COUNT(1) FROM UNNEST(label_name_array) AS label_name WHERE label_name = 'Low Vulnerability') > 0 AS is_low_vulnerability,
  (SELECT COUNT(1) FROM UNNEST(label_name_array) AS label_name WHERE label_name = 'tech_debt') > 0 AS is_tech_debt,
FROM {{ ref('shortcut_stories_history') }}
WHERE epic_name LIKE '%security-%'
